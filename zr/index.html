<!DOCTYPE html>
<!-- saved from url=(0034)http://jasonread.benmangguo.com/zr -->
<html class="pixel-ratio-2 retina"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>胰岛素</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="http://jasonread.benmangguo.com/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="./胰岛素_files/light7.min.css">
    <!--<link rel="stylesheet" href="/your-css-file.css">-->
</head>
<body>
    <!-- 你的html代码 -->

        <nav class="bar bar-tab">
          <a class="tab-item active no-transition replace" href="#page-yidao">
            胰岛素
          </a>
          <a class="tab-item no-transition replace" href="#page-bbf">
            丙泊酚
          </a>
          <a class="tab-item no-transition replace" href="#page-gap">
            GAP
          </a>
      </nav>
    <div class="page page-bbf" id="page-bbf">
        <div class="content">
            <div class="list-block">
                <ul>
                    <!-- Text inputs -->
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">病人体重</div>
                                <div class="item-input">
                                    <input type="number" placeholder="病人体重" id="cur-KG">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">负荷剂量</div>
                                <div class="item-title label" id="fuhe-val">0</div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">维持剂量</div>
                                <div class="item-title label" id="weichi-val">0</div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a onclick="getKG()" class="button button-big button-fill button-success">计算</a></div>
                </div>
            </div>
        </div>
    </div>
    <div class="page page-current page-yidao" id="page-gap">
        <header class="bar bar-nav">
            <h1 class="title">GAP和GAPratio在脓毒症的应用</h1>
        </header>
        <div class="content">
            <div class="list-block">
                <ul>
                    <!-- Text inputs -->
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">PaO2(mmHg)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="PaO2" id="pao2">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">PaCO2(mmHg)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="PaCO2" id="paco2">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">SaO2(%)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="SaO2" id="sao2">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">hb(g/dL)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="Hb" id="hb">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">Lac(mmol/L)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="Lac" id="lac">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">PcvO2(mmHg)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="PcvO2" id="pcvo2">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">PcvCO2(mmHg)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="PcvCO2" id="pcvco2">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">ScvO2(%)</div>
                                <div class="item-input">
                                    <input type="number" placeholder="ScvO2" id="scvo2">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                            <div class="item-title label">是否有容量性反应</div>
                                <div class="item-input">
                                  <label class="label-switch">
                                    <input type="checkbox" id = "switch">
                                    <div class="checkbox"></div>
                                </label>
                            </div>
                        </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a onclick="getGapSubmit()" class="button button-big button-fill button-success">计算</a></div>
                </div>
            </div>
            <div class="content-block">
                <div class="row">
                    <div class="col-100">
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">计算结果</div>
                                <div class="item-title" id="calculat" style="color: green"></div>
                                <br>
                                <div class="item-title label">如何操作</div>
                                <div class="item-title" id="how" style="color: red"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="page page-current page-yidao" id="page-yidao">
        <div class="content">
            <div class="list-block">
                <ul>
                    <!-- Text inputs -->
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">当前的BG</div>
                                <div class="item-input">
                                    <input type="number" placeholder="当前的BG" id="cur-BG">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">之前的BG</div>
                                <div class="item-input">
                                    <input type="number" placeholder="之前的BG" id="pre-BG">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">时间间隔</div>
                                <div class="item-input">
                                    <input type="text" placeholder="时间" id="picker2" readonly="">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">当前的泵速</div>
                                <div class="item-input">
                                    <input type="number" placeholder="当前的泵速" id="cur-speed">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">调整后的泵速</div>
                                <div class="item-title" id="fix-speed"></div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a onclick="getSubmit()" class="button button-big button-fill button-success">计算</a></div>
                </div>
            </div>
        </div>
    </div>

    <!--<script src="/your-js-file.js"></script>-->
    <script type="text/javascript" src="./胰岛素_files/zepto.js" charset="utf-8"></script>
    <script type="text/javascript" src="./胰岛素_files/light7.js" charset="utf-8"> </script>
    <input type="text" id="picker">
    <script>
        var getKG = function(){
            var val = parseFloat($("#cur-KG").val())
            $("#fuhe-val").text(0.1 * val + "-" + 0.3 * val + " ml")
            $("#weichi-val").text(0.05 * val + "-" + 0.4 * val + " ml/h")
        }
        var BGDeltaLevel = [
        [-200.0, -200.0, 0.0, -1.38],
        [-200.0, 1.38, -1.38, -2.78],
        [2.78, 0,  -2.78, -4.16],
        [0, -1.38,  -4.16, -5.5],
        ]

        var InsultLevel = [3.0, 6.5, 10, 15, 20, 25]
        var InsultDelta = [0.5, 1.0, 1.5, 2, 3, 4, 5]
        var BGLevel = [5.6, 7.8, 11.1]
        var getSubmit = function(){
            var curBG = parseFloat($("#cur-BG").val())
            var preBG = parseFloat($("#pre-BG").val())
            var curspeed = parseFloat($("#cur-speed").val())
            var timeStr = $("#picker2").val().split(" ")

            var hour = parseInt(timeStr[0]) + parseFloat(timeStr[2]) / 60.0
            if(hour == 0){
                $("#fix-speed").text((curBG * 18 / 100) / 2)
                return;
            }
            var bgLevel = 0
            for (var i = BGLevel.length - 1; i >= 0; i--) {
                if (curBG > BGLevel[i]) {
                    bgLevel = i + 1
                    break
                }
            };
            var bgDeltaLevel = BGDeltaLevel[bgLevel]
            var bgDelta = (curBG - preBG) / hour
            var speedLevel = -1
            for (var i = 0 ;  i < bgDeltaLevel.length; i++) {
                if (bgDeltaLevel[i] != -200 && bgDelta > bgDeltaLevel[i]){
                    speedLevel = 4 - i
                    break
                }
            };
            if (speedLevel == -1 && bgDelta < bgDeltaLevel[3]){
                speedLevel = 0
            }
            var level = 6
            for (var i = 0; i < InsultLevel.length; i++) {
                if (curspeed < InsultLevel[i]){
                    level = i
                    break
                }
            };

            // 4.16-5.5 并且 下降大于1.38
            if(parseInt(bgLevel) == 0 && parseInt(speedLevel) == 0){
                $("#fix-speed").text("停至血糖大于5.5，以泵速" + curspeed * 0.75 + "注射")
                return;
            }

            var fixInsluint = ""
            if (level == 6){
                if (speedLevel > 2){
                    fixInsluint = ">=" + (curspeed + (speedLevel - 2) * InsultDelta[level])
                }else if (speedLevel < 2){
                    fixInsluint = "<=" + (curspeed + (speedLevel - 2) * InsultDelta[level])
                }else{
                    fixInsluint = curspeed
                }
            }else{
                fixInsluint = curspeed + (speedLevel - 2) * InsultDelta[level]
            }

            console.log("speedLevel " + speedLevel)
            console.log("insulint " + level)
            console.log("bgDelta " + bgDelta)
            console.log("bgDeltaLevel " + bgDeltaLevel)
            console.log("bgLevel " + bgLevel)
            if (speedLevel == 0){
                $("#fix-speed").text("暂停30分钟后" + fixInsluint)
            }else{
                $("#fix-speed").text(fixInsluint)
            }
        }

        $("#picker2").picker({
          toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-left">Button</button>\
          <button class="button button-link pull-right close-picker">OK</button>\
          <h1 class="title">Title</h1>\
      </header>',
      cols: [
      {
          textAlign: 'right',
          values: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23"]
      },
      {
        textAlign: 'center',
        values: [":"]
      },
      {
          textAlign: 'left',
          values: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59"]
      }

      ]
  });
        var time = new Date()

        $("#picker2").val("0 : 0")
        $("#picker2").picker("setValue", ["0", ":", "0"])
        var getGapSubmit = function(){
            var luc = parseFloat($("#luc").val())
            var pao2 = parseFloat($("#pao2").val())
            var pcvo2 = parseFloat($("#pcvo2").val())
            var pcvco2 = parseFloat($("#pcvco2").val())
            var paco2 = parseFloat($("#paco2").val())
            var scvo2 = parseFloat($("#scvo2").val())
            var sao2 = parseFloat($("#sao2").val())
            var hb = parseFloat($("#hb").val())
            var rl = $("#switch")[0].checked

            var p = (pcvco2 - paco2)
            var c = (hb * 1.34 * (sao2 / 100 - scvo2 / 100) + 0.003 * (pao2 - pcvo2))
            var pc = p / c
            var r = ""

            if (( pc >= 1.8 ) || ( luc > 2 ) ){
                if ( scvo2 < 70 ) {
                    r = r + "提高DO2</br>"
                    console.log("")
                    if ( p < 6 ){
                        if ( sao2 < 95 ){
                            r = r + "氧疗增加PEEP</br>"
                        }else{
                            r = r + "输注血红蛋白</br>"
                        }
                    }else{
                        r =r + "提高CO</br>"
                        if (rl){
                            r = r + "补液</br>"
                        }else{
                            r = r + "多巴酚丁胺</br>"
                        }
                    }
                }else{
                    if ( p > 6){
                        r =r + "提高CO</br>"
                        if (rl){
                            r = r + "补液</br>"
                        }else{
                            r = r + "多巴酚丁胺</br>"
                        }
                    }else{
                        r = r + "调节微循环可能无效(微循环障碍/线粒体障碍)</br>"
                    }
                }
            } else {
                r = r + "无需介入"
            }

            console.log(rl)
            $("#calculat").html("GAP = " + p + "</br>" + "C(a-cv)O2 = " + c + "</br>" + "P(cv-a)CO2/C(a-cv)O2 = " + (p / c))
            $("#how").html(r)
        }
</script>
</body>


