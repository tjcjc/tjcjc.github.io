<!DOCTYPE html>
<!-- saved from url=(0034)http://jasonread.benmangguo.com/zr -->
<html class="pixel-ratio-2 retina"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>胰岛素</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="http://jasonread.benmangguo.com/favicon.ico">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="./胰岛素_files/light7.min.css">
    <!--<link rel="stylesheet" href="/your-css-file.css">-->
</head>
<body>
    <!-- 你的html代码 -->

    <div class="page page-current" id="page-1453282960157">
        <div class="content">
            <div class="list-block">
                <ul>
                    <!-- Text inputs -->
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">当前的BG</div>
                                <div class="item-input">
                                    <input type="number" placeholder="当前的BG" id="cur-BG">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">之前的BG</div>
                                <div class="item-input">
                                    <input type="number" placeholder="之前的BG" id="pre-BG">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">时间间隔</div>
                                <div class="item-input">
                                    <input type="text" placeholder="时间" id="picker2" readonly="">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">当前的泵速</div>
                                <div class="item-input">
                                    <input type="number" placeholder="当前的泵速" id="cur-speed">
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content">
                            <div class="item-inner">
                                <div class="item-title label">调整后的泵速</div>
                                <div class="item-title label" id="fix-speed">10</div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="content-block">
                <div class="row">
                    <div class="col-50"><a onclick="getSubmit()" class="button button-big button-fill button-success">计算</a></div>
                </div>
            </div>
        </div>
    </div>

    <!--<script src="/your-js-file.js"></script>-->
    <script type="text/javascript" src="./胰岛素_files/zepto.js" charset="utf-8"></script>
    <script type="text/javascript" src="./胰岛素_files/light7.min.js" charset="utf-8"> </script>
    <input type="text" id="picker">
    <script>
        var BGDeltaLevel = [
        [-200.0, -200.0, 0.0, -1.38],
        [-200.0, 1.38, -1.38, -2.78],
        [2.78, 0,  -2.78, -4.16],
        [0, -1.38,  -4.16, -5.5],
        ]

        var InsultLevel = [3.0, 6.5, 10, 15, 20, 25]
        var InsultDelta = [0.5, 1.0, 1.5, 2, 3, 4, 5]
        var BGLevel = [5.6, 7.8, 11.1]
        var getSubmit = function(){
            var curBG = parseFloat($("#cur-BG").val())
            var preBG = parseFloat($("#pre-BG").val())
            var curspeed = parseFloat($("#cur-speed").val())
            var timeStr = $("#picker2").val().split(" ")

            var hour = parseInt(timeStr[0]) + parseFloat(timeStr[2]) / 60.0
            var bgLevel = 0
            for (var i = BGLevel.length - 1; i >= 0; i--) {
                if (curBG > BGLevel[i]) {
                    bgLevel = i + 1
                    break
                }
            };
            var bgDeltaLevel = BGDeltaLevel[bgLevel]
            var bgDelta = (-curBG + preBG) / hour
            var speedLevel = -1
            for (var i = 0 ;  i < bgDeltaLevel.length; i++) {
                if (bgDeltaLevel[i] != -200 && bgDelta > bgDeltaLevel[i]){
                    speedLevel = 4 - i
                    break
                }
            };
            if (speedLevel == -1 && bgDelta < bgDeltaLevel[3]){
                speedLevel = 0
            }
            var level = 6
            for (var i = 0; i < InsultLevel.length; i++) {
                if (curspeed < InsultLevel[i]){
                    level = i
                    break
                }
            };

            var fixInsluint = ""
            if (level == 6){
                if (speedLevel > 2){
                    fixInsluint = ">=" + (curspeed + (speedLevel - 2) * InsultDelta[level])
                }else if (speedLevel < 2){
                    fixInsluint = "<=" + (curspeed + (speedLevel - 2) * InsultDelta[level])
                }else{
                    fixInsluint = curspeed
                }
            }else{
                fixInsluint = curspeed + (speedLevel - 2) * InsultDelta[level]
            }

            console.log("speedLevel " + speedLevel)
            console.log("insulint " + level)
            console.log("bgDelta " + bgDelta)
            console.log("bgDeltaLevel " + bgDeltaLevel)
            console.log("bgLevel " + bgLevel)
            if (speedLevel == 0){
                $("#fix-speed").text("暂停30分钟后" + fixInsluint)
            }else{
                $("#fix-speed").text(fixInsluint)
            }
        }

        $("#picker2").picker({
          toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-left">Button</button>\
          <button class="button button-link pull-right close-picker">OK</button>\
          <h1 class="title">Title</h1>\
      </header>',
      cols: [
      {
          textAlign: 'right',
          values: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23"]
      },
      {
        textAlign: 'center',
        values: [":"]
      },
      {
          textAlign: 'left',
          values: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", "51", "52", "53", "54", "55", "56", "57", "58", "59"]
      }

      ]
  });
        var time = new Date()

        $("#picker2").val("0 : 0")
        $("#picker2").picker("setValue", ["0", ":", "0"])
</script>


